<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web LUTs Minimal Demo</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        img { max-width: 100%; height: auto; border: 1px solid #ccc; }
        .controls button { margin: 5px; padding: 8px 12px; }
        #status { margin-top: 20px; padding: 10px; border: 1px solid #eee; background: #f9f9f9; white-space: pre-wrap; max-height: 200px; overflow-y: auto;}
    </style>
</head>
<body>
    <h1>Web LUTs Minimal Demo</h1>

    <img id="testImage" src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=500&h=300&fit=crop" alt="Test Image" crossorigin="anonymous">

    <div class="controls">
        <button id="applyNormal">Apply Normal (Identity)</button>
        <button id="applyVintage">Apply Vintage</button>
        <button id="resetImage">Reset Image</button>
    </div>

    <div id="status">Logs will appear here...</div>

    <script type="module">
        import { ColorGrader, PRESETS } from '../src/index.ts';

        const imageElement = document.getElementById('testImage');
        const statusDiv = document.getElementById('status');

        function log(message) {
            console.log('[DEMO LOG]', message);
            statusDiv.textContent += message + '\n';
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }

        // Global error handler for better visibility
        window.addEventListener('error', function(event) {
            log(`GLOBAL ERROR: ${event.message} at ${event.filename}:${event.lineno}:${event.colno}`);
            if (event.error) {
                log(`Error object: ${event.error.stack || event.error}`);
            }
        });
        window.addEventListener('unhandledrejection', function(event) {
            log(`UNHANDLED PROMISE REJECTION: ${event.reason}`);
             if (event.reason && event.reason.stack) {
                log(`Rejection stack: ${event.reason.stack}`);
            }
        });

        log("Script start. Initializing ColorGrader...");

        try {
            ColorGrader.init({
                // No selector, no autoload for this minimal test initially.
                // We will apply manually.
            });
            log("ColorGrader.init() called.");
        } catch (e) {
            log(`Error during ColorGrader.init(): ${e.message}`);
            console.error("Init error:", e);
        }

        document.getElementById('applyNormal').addEventListener('click', async () => {
            log("Applying 'Normal' preset...");
            try {
                await ColorGrader.apply({ target: imageElement, mode: PRESETS.NORMAL, strength: 1.0 });
                log("'Normal' preset application attempted.");
            } catch (e) {
                log(`Error applying Normal preset: ${e.message}`);
                console.error("Normal apply error:", e);
            }
        });

        document.getElementById('applyVintage').addEventListener('click', async () => {
            log("Applying 'Vintage' preset...");
            try {
                await ColorGrader.apply({ target: imageElement, mode: PRESETS.VINTAGE, strength: 1.0 });
                log("'Vintage' preset application attempted.");
            } catch (e) {
                log(`Error applying Vintage preset: ${e.message}`);
                console.error("Vintage apply error:", e);
            }
        });

        document.getElementById('resetImage').addEventListener('click', () => {
            log("Resetting image...");
            try {
                ColorGrader.reset(imageElement);
                log("Image reset attempted.");
            } catch (e) {
                log(`Error resetting image: ${e.message}`);
                console.error("Reset error:", e);
            }
        });

        // Ensure the image is loaded before attempting any operations if ColorGrader.init is not handling it.
        if (imageElement.complete) {
            log("Image was already complete.");
        } else {
            imageElement.onload = () => {
                log("Test image loaded.");
            };
            imageElement.onerror = () => {
                log("Error loading test image!");
            }
        }
         log("Event listeners attached.");

    </script>
</body>
</html> 